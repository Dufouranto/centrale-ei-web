from recommandation.pymongo_test import get_database
import requests as req

db = get_database()
db.users.drop()
key_pwd =  "Bearer eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJ1c2VyIjp7ImlkIjoxMjQ4MiwibG9naW4iOiIyMDIxbWFyc2FsbGkiLCJ1cGRhdGVkQXQiOiIyMDIxLTA5LTE0VDIxOjM1OjEzLjAwMFoiLCJyb2xlcyI6IiJ9LCJzY29wZSI6ImRlZmF1bHQgbGlua2NzLXVzZXI6cmVhZCBsaW5rY3MtdXNlcjp3cml0ZSBsaW5rY3MtYXNzbzpyZWFkIGxpbmtjcy1hc3NvOndyaXRlIGxpbmtjcy1hZG1pbjpyZWFkIGxpbmtjcy1hZG1pbjp3cml0ZSIsImNsaWVudCI6eyJpZCI6IjYiLCJjbGllbnRJZCI6IjE0MDFhYTQ4NTEzMmZlNzJmODVkYWNiNTRlMDE1M2FhMmYxMjE5MzgifSwiaWF0IjoxNjU0NzAxNTUyLCJleHAiOjE2NTQ3MjY3NTIsImVuY3J5cHRlZEFjY2Vzc1Rva2VuIjoiMTI1NzNiYTIyMzVhZDE3NWU4NjIwNmI5NThiNzliYTRmYzRjNjgxM2ZlYjMzZDYyNjBlOTM3ZmQzMjM1OTYzYmYyOWE5MGZlYmQ1ZDcyNDNlYjg1MjIyYTRlYjc3ZGU2Zjg2Y2Q4ZWM5ZjM1YjQyMzA0MWU5MGQyNzE0NTczYWNlZjU5NWFjNDE5M2FlNTYyMDk2ZmQ3N2JiMTY2ZDNiOGRmMTA1ZDU2ZWQzZWFlMjFmMzVmOWE0ZjNhM2RkNGJlNTFkMjhiMzJmZDk4MzQzZjhjYmFlNmVhOTYyYzU1MjY1MmExM2M1NjI0Y2YzODhkNTA2YzVkZWI1MWMxYTRlNDA5NjJmNDcwMDE0ZTY0ODMzMTM4OTg4OWFkZTMyNzQ2YzAxZjdiM2RkMDZmZGY2MDk3OTI3ZjY5NTY2YjAzNDhkZDcwYTdlNjQxYjhiZjk4OGRjMmQ2ZGQ1MjA5NTE3MDIxNWJjMDUzMzZmOGM3OTU3ODhhMzQwOGRiZDc0MTk0ODI3YTU2M2M4N2IxODIzODljYjk4MDM4MTc5MWI1NmU4NzRjZDNkMDVmMGQyMTBjMDI2YTUyNzU2N2JlOTVhYjg4ZTIwODQxMzE0OWI3NjMyZGYwNGMwMjczMTg1ODU4ZGNhNWJhODVhZDY0ZTBiNTc2NWQ5NzkwNjcxMGE1Y2E2MDUwNTM5YjU4ZGE5NTMxODU1MGY2YmVhODM2NGQ1YjBkNmRhNTI3NWQ0ZjNhNzI3Mzk0MmUwMTdmNTUyYmE5OTljYzNhMDg4MGNkY2U0NWNkMzg2Mjk3ZTMxMmM1NWQyNTc4NzcyZjVmZDVkNDQ0MjI4NzAzOTdiNmExYWU1Y2I1NDU2OTA4NWY0OGIyMmFkZGMyMDVlMTYxYjk0NzBiNjY4NDI2NmFlYzJkZDAxMzgyZDJlMDY1YTNlNWRiNWI1YjE4MTkwMmQzY2U2YTM0YjAzN2MyZGE3MWI5Y2QzYTg5OWM5NTgzYTNhZjA5YzY3NGZjZDVjYzUwMmY3MTZjMWEwZmQ2Mjc4YzYzNTgyYzVjNjE3NTQ0YWFhMTUxZjgzMTQzZWE1NmY4NWE5NzY5YmE0OTlkM2YxZjMzYTI2MzE0MzRkZjg0Nzc3NDFlMDY2MzdhMGViZTJmNzJkZGNiMWFhNzgxNDY4MTVjY2Q5N2JmZTEyNWQ4ZTBlZjI1YWZiYThjOGFmOGUyYTVmOWQ5M2E4Y2E2NjFiZTdjZWE4MWNkOGI3MDZkMzYzZTg5NmM5ZWZkMWM4MDdlNDEwYTIwM2ZhN2NjN2FlMzdkNzhkODM4MmJmYTdhOTllYzgwMTk2ZThkMGE2YWI1NGFiNjQ4OGNlZjI5YzRkN2ViYmRkNWM2OWRlOGNkNjk2NzgwYWViMTQ2NjRmMGM3NDlkZjA0N2ZhOWY2ZTBmYjQxMWUzYmFjMGIyZDA2YThmNmQzZDlhMzY1ZjMxOTY1YTk1ZDU2YzQxZjQyNjExMDdhMGRjZWY3Y2NhZjVjYjMyZmExOGUzNTNlMGY2Yzg5MTlkNjg3YTUyMzY2MjQzMDhhODA1Y2I1MmEzMWNkZjIzZWYzOTUxNDE2Yjk3ODFlM2RmN2Y3OGI2NDVjMjM2MmYxMDYyM2JiOGQzMmY4ZjVkMjQ4ZDY3ZTM3ZDUyMzBiOGUxNjg0Mzk4NjgxOGU4ODE2YjU1YTA0NjFlOWZiYTk0MzQ1YzdkNGE5MGJmOWVkOGQxMjAyNGU5ODAwYTc4NGI2NGEwY2M0MDczNDE4MWUyMThiZjM3OTVjYzlmYzYyOWIyZWFlNDAwZDdkMmVlYjhiYjVjYjlkN2RhZDA2ODIxOGU5NDEzNzk5ZDQxMjUwZDJkZTI2M2MwYmQzMTQwMGZlMmU1NWRkZWM2ZGIxMmExOTU4Zjg4Y2I4N2QxN2RiOTVmNDU1YmI1ZGNhMjZhZDkyNTNhMWY2ZDc2YjcxMzIyNTY0ODc0NTMxMmY1NTExM2E4ZmYzNTliYWFmYTAxZDQ4NjUyOTU0ZmNlZmMyZDE0NjY3MTE5N2YwYTZlZDJhMWZhZDE3OTFjY2YwMTQ2ODkxY2JkMzFhM2FjNGIyOWMzOTFmY2Y0YTU0MGRkZjNhZTAzYjUzZjk4NWMwZGExYjY3YTc2ZWNlNzhhNWJiYThlNmY3YWI1MTk2MjVmMmE1NjUxZjA2MDRhMjRkYjk5M2MxNDNiYTJjYTVkMWYzYjVkNDFjZjM4OWQyNzI4NmNlNzBhN2U4ZmEwYjM2YWE0OTA4NmI3MTIyMmIwMDZhYjU0ODUyYTAzN2E4MDVhNTRjNjFjZDJiYTFmMDM0MWQyNmNkNmI2ZTdlMmM0ZjM3MmRmM2RiNDlhYTJjZTMwOTcyNDgzOGJlYTA3NDkzNDMwMTRlOTFiNmU2ODBmMmEyZGFmNjFkYzZkMDk4NGVkY2ViZWIyMzgzOTQ4ODE3NTZjODczYWVlMWZmNmUyZWM0MDBjMzAxM2M0MDU4ZGEwOGE2MzhhN2M5ZGEyZmNiMDNiYzcwZGYzNmYyZDM4NDI5OGYzNmE5YjdhYjU4MzVmOTViNjc1NGU5MmNmMDk1MDQ0ZmFjYTY1YjAxYjk1MDk2NGY0NGM2N2JmNzhlNzAzYmY1ODhhNDI1ZjI3M2FjYjRlNjZkMzQyOGM1NGQ0M2U0ZDA2MjNiZmY0YjMwM2U0N2RlOWVhYzY4NDljNjljZmI0NzMyNzA4YzllNTg4NTFmMDZkM2IxNDkxZWIzYTBlNzJhZTdhZTUyNWU1M2VkZGU2MTExMTViYzhkY2VmMmEzODBlZjVlOTJkOGUyYzA0YzljZmMwYTY0ZDg4ZTJhNGUxNGQ1YjdmOTBhYzVjODYzMTA4MzRhMDQ0NDAzNjM0MmI0OTAxNmMwODQxNzQ0Y2VhMTJjOGIzZWJmOTkzMzQwMTIyYjkxZGY5MGY3NzI2YjA3NGVmN2UzMGU1NjI2ZTA3ZjM4OTY5YWQ0M2U0NjRlMDlmMDc4MTVmNjEzYjgxMjdjOWE5MmFkODU5MDgzMzMyYzA4YmZkZDFhMmJhNzY3MjQ1M2JjN2MzZjJlMjk2Mjg1YmEyOTVjZmMyOWQ5YTM4ZDk4NWU5ZTQ1ZWI1YzczYjcyZTE5YTciLCJlbmNyeXB0ZWRSZWZyZXNoVG9rZW4iOiIxMjU3M2JhMjIzNWFkMTc1ZTg2MjA2Yjk1OGI3OWJhNGZjNGM2ODEzZmViMzNkNjI2MGU5MzdmZDMyMzU5NjNiZjI5YTkwZmViZDVkNzI0M2ViODUyMjJhNGViNzdkZTZmODZjZDhlYzlmMzViNDIzMDQxZTkwZDI3MTQ1NzNhY2VmNTk1YWM0MTkzYWU1NjIwOTZmZDc3YmIxNjZkM2I4ZGYxMDVkNTZlZDNlYWUyMWYzNWY5YTRmM2EzZGQ0YmU1MWQyOGIzMmZkOTgzNDNmOGNiYWU2ZWE5NjJjNTUyNjUyYTEzYzU2MjRjZjM4OGQ1MDZjNWRlYjUxYzFhNGU0MDk2MmY0NzAwMTRlNjQ4MzMxMzg5ODg5YWRlMzI3NDZjMDFmN2IzZGQwNmZkZjYwOTc5MjdmNjk1NjZiMDM0OGRkNzBhN2U2NDFiOGJmOTg4ZGMyZDZkZDUyMDk1MTcwMjE1YmMwNTMzNmY4Yzc5NTc4OGEzNDA4ZGJkNzQxOTQ4MjdhNTYzYzg3YjE4MjM4OWNiOTgwMzgxNzkxYjU2ZTg3NGNkM2QwNWYwZDIxMGMwMjZhNTI3NTY3YmU5NWFiODhlMjA4NDEzMTQ5Yjc2MzJkZjA0YzAyNzMxODU4NThkY2E1YmE4NWFkNjRlMGI1NzY1ZDk3OTA2NzEwYTVjYTYwNTA1MzliNThkYTk1MzE4NTUwZjZiZWE4MzY0ZDViMGQ2ZGE1Mjc1ZDRmM2E3MjczOTQyZTAxN2Y1NTJiYTk5OWNjM2EwODgwY2RjZTQ1Y2QzODYyOTdlMzEyYzU1ZDI1Nzg3NzJmNWZkNWQ0NDQyMjg3MDM5N2I2YTFhZTVjYjU0NTY5MDg1ZjQ4YjIyYWRkYzIwNWUxNjFiOTQ3MGI2Njg0MjY2YWVjMmRkMDEzODJkMmUwNjVhM2U1ZGI1YjViMTgxOTAyZDNjZTZhMzRiMDM3YzJkYTcxYjljZDNhODk5Yzk1ODNhM2FmMDljNjc0ZmNkNWNjNTAyZjcxNmMxYTBmZDYyNzhjNjM1ODJjNWM2MTc1NDRhYWExNTFmODMxNDNlYTU2Zjg1YTk3NjliYTQ5OWQzZjFmMzNhMjYzMTQzNGRmODQ3Nzc0MWUwNjYzN2EwZWJlMmY3MmRkY2IxYWE3ODE0NjgxNWNjZDk3YmZlMTI1ZDhlMGVmMjVhZmZlMGUxYTNjOGY5MDhkNmM0NDZiODdkNGUxMGM5ZTUwMjc4NDY1NTUzN2ZmMGY1MmE0ZjU5YzA2NDQ2MjA2NjU5MWQzYmM1Nzc4MmU3NjgyMTJlZTdmNjIxNTE2ZmFiY2E5YmVlOWRjNDkzYmM3N2NkMmY5NjQyMDcwNzkzYWY1MjBmNTNjN2YzNzRmMDBiZDVhMWYwN2RiMWQ3ZjgwNjkxZDk4YzMxYjZkZTk0MjU0YzE2NjAyOTk2YmZiMTYxODMyNDQxNWI0ZWVmYmExOWE4MmY3MjY4ODY3YWYwMDI0ODVlYTA1Mjc1MWYwZDhhMjJhYzg2M2Q1NTA4NWQ0YTVmY2JhZmQ3Mzg0MWRjNjVlZTE4NzBmZDNmMjFmNzlhN2YyMDUwZGYzYmRhNDczZWRmNTVkYzQyZjI4ODg4NDE1ZTgyZGRhYjZjMWNhY2QzOTk3OTFmYzI1MDhkODNjMzZlMjg1ZGEyNzlhOWEwZjBhNmE0NmNmNjZmN2M5OThlMDcyOTkwYWJkZTMyYjI4ODgzMGY5MTFhOTM4ODFhMzljMTI1Mzk5NmQ2ZjZiMmM3MWJkZTAwOTFjNjcyZjc5MDYzNDZkNGE0YWFlMDE4NGM4NmM0MmYwMDMwYmVkODFhMDlkNjU1ZGVhMGE2NDU0OTA2ZDZlNzU3NDU1YjQ2MTNlNTNhM2IzNGYyMzYzNzM5ZjA1NDgwOGQ3OWFmYmJmMDFhMjkwNzE5Y2JjZGRjNmZiZDNjOGY1MGE0ZmRlMzdkZDM5MzU2MjViZjY2NWFhZjVhOTVkNGIxYmViZWNlNmM4NWYyMDUyZDVkZWQzNzFjMjQ2NDRlMzUxNjIxNTMxOGFlMTg2N2U4Mzg3MDExYWQzM2M4OWJmYjE5NTAxMDRmZDgwOWUwNDUyN2ZkN2I2NjllOTdiMjhhYzJhZjNmMzFiNjc5ZTBmNDVhZmJiNjU4NWNkOTNhOTY0YWUyNGNkNjU1OWQ2YjA4MDIyMDk3NTAxNTllMTU3ZDQ4Y2RlOTZkYjU5M2JlMzdmMjI0MmZhOTUzODliMWU0NDlmYjkxZWVjYmFmNWE5MDViODlmMTQwZjFjZDFlODYyNmExMmE5NDlkZjBmNWYxYTA0NjM1YTEwZWZiYTgxOThmMjljOWVlOTY3NjU0MWMwNTdjYzRmYTVkYzY3ZDVhZjM3NjMwMGE0MzZjNDllNjc1Nzc1YjkwNDVmZDA4MTI4NjkyYjUyMjljM2QzY2ZiZDQ5NTVkOWViMWYzNDZlNWEyYWVjYTZlOGIwMzBhMTc2MWI2ODA4NTIzMGY1NDA2MWU2OWZiMDgyODM0YjI5NTM2MGI3Nzc1YjE5MjJhNjQwZjY3NDE1OGQ1N2IwNDgzZWU4MGM1NjUyMzdhYjE4NWNlM2UyYWZjYzUwYTc4ZGVhMjUzMDg5YjUyMzkzNWFiNWMyZWZkZGJlMTY3MmQ4MjAxM2VkZTZlYzBhMTM3ODBjNWY2ZjhlM2E0NmU4N2I1OWM2OGE0NTlmY2YwY2Q3NGNkYzRhODMyM2E2OGI0MjdkODQzN2E2MzA1MDI5OGUyMjBhMTg5ZTgzZjhhMDE4MDNkOTM3MjAwMmQ3NGM3OWIwYWIxODNmOGRkYmIwZGQ3MTI3OWEzYjVjMDk0Zjk5ZWU2Zjc3ZWZkN2ExNzk0YzFlNjQyOGNkZDY2NzQ2OThkOWY5YjA4NzkzOTJmZjJmZTliM2JjMGMyNjg3ZjA0ZGM0MzUyZmFkMjZkMzgxOTkwNDA1ZTViZTg2MDBkZmYwY2EzZTAxOTZhNGM5NDViYjVmYmYxNjY3ZTFmODIwYzRkOGY2MDlhMWExOWQwZTJmNzBjNjMxMjNlZjEwZmE1OThhMDhkYjZhZDZlYmY1NGE5YjNmYjhhZDY0NDJlMmZlNmMwMzJlNmNjZSJ9."

r = req.post("https://frontproxy.linkcs.fr/api/v1/graphql/",
json={
    "operationName": "GetPromo",
    "query": "query GetPromo($promo: Int!, $limit: Int, $offset: Int) {  getPromotion(promotion: $promo, limit: $limit, offset: $offset) {    id    login    firstName    lastName    personalPhotoURI    ctiPhotoURI    promotion    __typename  }}",
    "variables": {
        "limit": 150,
        "promo": 2021
    }
},
headers={
    "authorization" : key_pwd,
    "Origin": "linkcs.fr"
})

student_list = r.json()["data"]["getPromotion"]
db_list = [{"email": "{}.{}@student-cs.fr".format(stu["firstName"], stu["lastName"]), "firstName": stu["firstName"], "lastName": stu['lastName']} for stu in student_list]

collection_users = db["users"]
collection_users.insert_many(db_list)